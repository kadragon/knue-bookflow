spec_id: SPEC-bookinfo-001
title: "Aladin Book Information Lookup"
description: |
  Fetch detailed book metadata from Aladin Open API for newly borrowed books
  to enrich reading records.

given_when_then:
  - given: "New book is detected (chargeDate == today)"
    when: "Book info lookup is triggered"
    then: "Aladin API is called with book ISBN"

  - given: "Valid ISBN is provided"
    when: "Aladin ItemLookUp API is called"
    then: "Book metadata (title, author, cover, description) is returned"

  - given: "ISBN not found in Aladin"
    when: "Aladin API is called"
    then: "Fallback to library-provided info only"

  - given: "Aladin API is unavailable"
    when: "API call is made"
    then: "Error is logged and process continues without enrichment"

acceptance_tests:
  - id: TEST-bookinfo-001
    desc: "Detect newly borrowed books by chargeDate"
  - id: TEST-bookinfo-002
    desc: "Call Aladin API with correct parameters"
  - id: TEST-bookinfo-003
    desc: "Parse book metadata from Aladin response"
  - id: TEST-bookinfo-004
    desc: "Handle ISBN not found gracefully"
  - id: TEST-bookinfo-005
    desc: "Handle API timeout/error gracefully"

technical_notes:
  endpoint: "http://www.aladin.co.kr/ttb/api/ItemLookUp.aspx"
  query_params:
    ttbkey: "{ALADIN_API_KEY}"
    itemIdType: "ISBN"
    ItemId: "{isbn}"
    output: "js"
    Version: "20131101"
    OptResult: "previewImgList"
  response_fields:
    - title
    - author
    - publisher
    - pubDate
    - description
    - cover (image URL)
    - isbn13
    - categoryName

dependencies:
  - spec: "SPEC-charges-001"

linked_tasks:
  - TASK-005
