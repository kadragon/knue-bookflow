spec_id: SPEC-new-books-001
title: "New Books API with Pagination"
description: |
  API endpoint for fetching new books from KNUE library within a date range.
  Supports pagination (offset-based) for infinite scroll.
  Transforms library API response to frontend-friendly format.

given_when_then:
  - given: "Valid days parameter with pagination"
    when: "GET /api/new-books is called"
    then: "Returns new books with metadata and hasMore flag"

  - given: "days parameter is missing"
    when: "GET /api/new-books is called"
    then: "Uses default 30 days"

  - given: "max parameter is missing"
    when: "GET /api/new-books is called"
    then: "Uses default 50 books per page"

  - given: "Invalid pagination parameters (days > 365, max > 100, offset < 0)"
    when: "GET /api/new-books is called"
    then: "Returns 400 error with validation message"

  - given: "Library API fails or times out"
    when: "New books fetch is attempted"
    then: "Returns 500 error with error message"

  - given: "Offset exceeds total results"
    when: "Pagination is requested"
    then: "Returns empty items array with hasMore=false"

  - given: "Frontend scrolls to bottom"
    when: "More results are available (hasMore=true)"
    then: "Fetches next page with incremented offset"

acceptance_tests:
  - id: TEST-new-books-001
    desc: "Valid request returns transformed results with metadata"

  - id: TEST-new-books-002
    desc: "Default days is 30 when not specified"

  - id: TEST-new-books-003
    desc: "Default max is 50 when not specified"

  - id: TEST-new-books-004
    desc: "Invalid days parameter (0, 366, NaN) returns 400 error"

  - id: TEST-new-books-005
    desc: "Invalid max parameter (0, 101, NaN) returns 400 error"

  - id: TEST-new-books-006
    desc: "Invalid offset parameter (-1, NaN) returns 400 error"

  - id: TEST-new-books-007
    desc: "Library API error returns 500 with error message"

  - id: TEST-new-books-008
    desc: "hasMore flag is true when more results available"

  - id: TEST-new-books-009
    desc: "hasMore flag is false when no more results"

  - id: TEST-new-books-010
    desc: "Infinite scroll loads next page on scroll to bottom"

  - id: TEST-new-books-011
    desc: "parsePublication handles various formats correctly"

dependencies:
  - governance: "coding-style"
  - service: "LibraryClient.getNewBooks"
  - spec: "SPEC-search-001"

linked_tasks:
  - TASK-066
