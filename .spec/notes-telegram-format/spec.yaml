spec_id: SPEC-notes-telegram-002
title: "Format Telegram note broadcast with MarkdownV2"
description: |
  Update the daily reading note broadcast to use Telegram MarkdownV2 formatting for
  better readability. Messages should include bold title, italic author, page line,
  and a quoted content block, while safely escaping all MarkdownV2 special characters.

given_when_then:
  - given: "A note with title, author, page number, and content exists"
    when: "The broadcast formats the Telegram message"
    then: "The message uses MarkdownV2 with bold title, italic author, page line, and blockquote content"

  - given: "Note fields contain Markdown-reserved characters (e.g., _, (, ), -, .)"
    when: "Formatting the Telegram message"
    then: "All reserved characters are escaped so Telegram renders text correctly"

  - given: "The broadcast sends the Telegram request"
    when: "parse_mode is set"
    then: "The request includes parse_mode=MarkdownV2 and disables link previews"

acceptance_tests:
  - id: TEST-telegram-md-001
    desc: "Formats message using MarkdownV2 with bold title, italic author, page line, and quoted content"
  - id: TEST-telegram-md-002
    desc: "Escapes MarkdownV2 reserved characters in title/author/content"
  - id: TEST-telegram-md-003
    desc: "Sends Telegram request with parse_mode=MarkdownV2 and disable_web_page_preview=true"
  - id: TEST-telegram-md-004
    desc: "Quotes multi-line content line-by-line in the message"
  - id: TEST-telegram-md-005
    desc: "Handles missing author or page numbers without malformed formatting"

dependencies:
  - SPEC-notes-telegram-001

linked_tasks:
  - TASK-035
