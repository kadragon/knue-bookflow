# Environment Configuration

project:
  name: knue-bookflow
  type: cloudflare-worker

runtime:
  platform: cloudflare-workers
  language: typescript
  node_version: "20"

placement:
  mode: smart

observability:
  logs:
    enabled: true
    head_sampling_rate: 1.0
  traces:
    enabled: true
    head_sampling_rate: 0.1

dependencies:
  dev:
    - wrangler
    - typescript
    - vitest
    - @cloudflare/workers-types
  runtime:
    - zod

external_apis:
  library:
    base_url: https://lib.knue.ac.kr/pyxis-api
    endpoints:
      login: /api/login
      charges: /8/api/charges
      renew: /8/api/renew-charges/{chargeId}
  aladin:
    base_url: http://www.aladin.co.kr/ttb/api
    endpoints:
      item_lookup: /ItemLookUp.aspx

secrets_required:
  - LIBRARY_USER_ID
  - LIBRARY_PASSWORD
  - ALADIN_API_KEY
  - TELEGRAM_BOT_TOKEN
  - TELEGRAM_CHAT_ID

bindings:
  d1:
    - name: DB
      database_name: knue-bookflow-db

cron_schedule: |
  - "0 3 * * *"   # Telegram note broadcast, daily at 12:00 KST (03:00 UTC)
routes:
  - pattern: "book.kadragon.work/*"
    zone_name: "kadragon.work"
    note: "Deploy with `wrangler deploy` to apply"
